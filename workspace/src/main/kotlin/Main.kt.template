import io.github.takahirom.codingagentextension.model.*
import io.github.takahirom.codingagentextension.claudecode.writeClaudeCodeExtension
import java.nio.file.Path

fun main(args: Array<String>) {
    val outputDir = Path.of(args.firstOrNull() ?: "output")

    // 1. Create a plugin with command and skill
    val plugin = Plugin.Builder(
        name = "my-plugin",
        description = "My awesome plugin",
        version = "1.0.0"
    )
        .author(name = "My Team")
        .addCommand(
            Command.Builder(
                name = "greet",
                description = "Say hello",
                body = "# Greet Command\n\nSay hello to the user."
            ).build()
        )
        .addSkill(
            Skill.Builder(
                name = "coding-style",
                description = "Coding style guidelines",
                body = """
                    # Coding Style

                    - Use 4 spaces for indentation
                    - Max line length: 120 characters
                """.trimIndent()
            ).build()
        )
        .addSubagent(
            Subagent.Builder(
                name = "code-reviewer",
                description = "Review code changes",
                body = "You are a senior code reviewer. Focus on code quality and security."
            )
                .tools("Read", "Grep", "Glob", "Bash")
                .model("inherit")
                .build()
        )
        .addHook(
            hook = HookMatcher.Builder(
                event = HookEvent.PostToolUse,
                hook = HookCommand.Command("\${CLAUDE_PLUGIN_ROOT}/scripts/format.sh", timeout = 30)
            )
                .matcher("Write|Edit")
                .build()
        )
        .build()

    // 2. Create marketplace with the plugin
    val marketplace = Marketplace.Builder(
        name = "my-marketplace",
        owner = Owner(
            name = "My Team",
            email = "team@example.com"
        )
    )
        .addPlugin(plugin)
        .build()

    // 3. Write everything with a single call
    marketplace.writeClaudeCodeExtension(outputDir)

    println("Done! Check $outputDir/my-marketplace/")
}
